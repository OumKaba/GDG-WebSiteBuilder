datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                String     @id @default(uuid())
  email             String     @unique
  password          String?
  name              String?
  provider          String     @default("email")
  providerId        String?
  isVerified        Boolean    @default(false)
  verificationCode  String?
  verificationExpiry DateTime?
  darkMode          Boolean    @default(false)
  
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  
  websites          Website[]
  templates         Template[]
  images            Image[]
}

model Website {
  id          String     @id @default(uuid())
  name        String
  description String?
  content     Json       // Garde content pour compatibilité avec ancien code
  theme       String     @default("light")
  status      String     @default("draft")
  seoScore    Int?
  
  userId      String
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  templateId  String?
  template    Template?  @relation(fields: [templateId], references: [id], onDelete: SetNull)
  
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  pages       Page[]
  styles      GlobalStyle?
  
  @@index([userId])
}

model Page {
  id        String   @id @default(cuid())
  name      String
  slug      String
  isHome    Boolean  @default(false)
  order     Int      @default(0)
  
  websiteId String
  website   Website  @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  sections  Section[]
  
  @@unique([websiteId, slug])
  @@index([websiteId])
}

model Template {
  id           String           @id @default(uuid())
  name         String
  description  String?
  type         String
  thumbnail    String?
  category     TemplateCategory @default(CUSTOM)
  content      Json             // Garde content pour compatibilité
  
  isPublic     Boolean          @default(false)
  isPredefined Boolean          @default(false)
  
  userId       String?
  user         User?            @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  
  sections     Section[]
  websites     Website[]
  
  @@index([userId])
  @@index([type])
}

enum TemplateCategory {
  EVENT
  UNIVERSITY
  PORTFOLIO
  BLOG
  BUSINESS
  CUSTOM
}

model Section {
  id          String   @id @default(cuid())
  name        String
  order       Int
  
  pageId      String?
  page        Page?    @relation(fields: [pageId], references: [id], onDelete: Cascade)
  
  templateId  String?
  template    Template? @relation(fields: [templateId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  components  Component[]
  styles      SectionStyle?
  
  @@index([pageId])
  @@index([templateId])
  @@index([order])
}

model Component {
  id          String         @id @default(cuid())
  type        ComponentType
  order       Int
  content     Json
  
  sectionId   String
  section     Section        @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  
  styles      ComponentStyle?
  
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  
  @@index([sectionId])
  @@index([order])
}

enum ComponentType {
  HEADER
  TEXT
  BUTTON
  IMAGE
  CARD
  COUNTDOWN
  FORM
  AGENDA
  CAROUSEL
  BULLET_LIST
  TESTIMONIAL
  GALLERY
  SPEAKERS
  COUNTER
  NAVBAR
  FOOTER
  INNER_SECTION
}

// ==================== STYLES ====================

model GlobalStyle {
  id              String   @id @default(cuid())
  primaryColor    String?
  secondaryColor  String?
  backgroundColor String?
  textColor       String?
  fontFamily      String?
  fontSize        String?
  breakpoints     Json?
  
  websiteId String   @unique
  website   Website  @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SectionStyle {
  id               String  @id @default(cuid())
  width            String?
  height           String?
  maxWidth         String?
  backgroundColor  String?
  backgroundImage  String?
  padding          Json?
  margin           Json?
  borderWidth      String?
  borderColor      String?
  borderRadius     String?
  borderStyle      String?
  boxShadow        String?
  opacity          Float?
  responsiveStyles Json?
  
  sectionId String  @unique
  section   Section @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ComponentStyle {
  id               String    @id @default(cuid())
  width            String?
  height           String?
  backgroundColor  String?
  backgroundImage  String?
  fontSize         String?
  fontWeight       String?
  textColor        String?
  textAlign        String?
  lineHeight       String?
  padding          Json?
  margin           Json?
  borderWidth      String?
  borderColor      String?
  borderRadius     String?
  borderStyle      String?
  boxShadow        String?
  opacity          Float?
  animation        String?
  responsiveStyles Json?
  
  componentId String    @unique
  component   Component @relation(fields: [componentId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// ==================== IMAGES & MEDIA ====================

model Image {
  id        String   @id @default(cuid())
  filename  String
  url       String
  size      Int
  mimeType  String
  alt       String?
  
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@index([userId])
}

// ==================== PERFORMANCE & SEO ====================

model PerformanceScore {
  id                  String   @id @default(cuid())
  websiteId           String
  seoScore            Float
  performanceScore    Float
  accessibilityScore  Float
  pageSize            Int
  loadTime            Float?
  keywords            String[]
  recommendations     Json
  
  createdAt           DateTime @default(now())
  
  @@index([websiteId])
}